#!/usr/bin/env python3

from todoist.api import TodoistAPI
import config
from datetime import datetime, timedelta


api = TodoistAPI(config.todoist_api)

def get_today_tasks():
    tasks_today = []

    # get items from todoist
    api.sync()
    items = api.state['items']

    # Get "today", only keep Day XX Mon, which Todoist uses
    # today = datetime.utcnow() + timedelta(hours=20)
    today = datetime.now()
    # today = today.strftime("%a %d %b %Y")
    today = today.strftime("%Y-%m-%d")

    # NB: item['due_date_utc'] is unicode; we cast to str for this comparison
    # slicing :10 gives us the relevant parts
    # for item in items:
    #     if (str(item['due.date'])[:15] == today):
    #     	if item['checked'] == 0:
    #     		tasks_today.append(item)

    # for item in items:
    	# print(item['content'],item['due_date_utc'])
    for item in items:
        if item['due'] is not None:
            if item['due']['date'] == today:
                if item['checked'] == 0:
                    tasks_today.append(item)

    return tasks_today

def print_today_tasks():
    tasks = get_today_tasks()

    if tasks == []:
    	print("Nothing to do!")

    for task in tasks:
        print(task['content'])

bedroom_url = 'https://home.wadeallen.me/api/states/sensor.dht_sensor_temperature'
levi_url = 'https://home.wadeallen.me/api/states/sensor.levi_room_temperature'
church_url = 'https://church.wadeallen.me/api/states/sensor.shelly_temperature'
church_key = config.ha_api
home_key = config.home_ha_api
church_headers = {
    'Authorization': f'Bearer {church_key}',
    'content-type': 'application/json',
}
home_headers = {
    'Authorization': f'Bearer {home_key}',
    'content-type': 'application/json',
}

church_response = get(church_url, headers=church_headers)
bedroom_response = get(bedroom_url, headers=home_headers)
levi_response = get(levi_url, headers=home_headers)
sanctuary_data = json.loads(church_response.text)
bedroom_data = json.loads(bedroom_response.text)

print("Today's Todos")
print("----------------")
print_today_tasks()


