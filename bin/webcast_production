#! /bin/bash

# get date for this coming Sunday
date=$(date -d 'sun' +'%Y-%m-%d')

# change to worship directory and move files to posts directory
worship_dir=$HOME/Sites/fbcmuncie_2020/content/worship
cd $worship_dir
if [ -f $worship_dir/${date}-*.md ]
then
  mv ${date}-*.md /home/wadeallen/Sites/fbcmuncie_2020/content/video
  echo "Worship file has been moved to video directory"
else
  echo "The worship file for ${date} does not exist or has already been moved"
fi

cd -
# #count the number of files in the folder
# count=`ls -l *.mkv | wc -l`

# #add each file to an array called videos
# for file in $(seq 1 $count); do videos+=(my_video-${file}.mkv); done

# #print the series of videos with a + before each file name
# video=`printf -- " +%s" ${videos[*]}`

# #merge the videos into one mkv. the ${video:2} takes the + off of the first video file
# mkvmerge -o ${date}.mkv ${video:2}

# # # convert video using handbrake and place on desktop
# HandBrakeCLI --preset "H.264 MKV 480p30" -i ${date}.mkv -o ${date}-upload.mkv
# echo "-----"
# echo "file compressed with Handbrake"

# HandBrakeCLI --preset "Fast 480p30" -i ${date}-upload.mkv -o ${date}-dvd.mp4
# echo "-----"
# echo "dvd file created with Handbrake"

# # convert sermon into mp3, also create file duration.txt file
~/bin/audio ${date}-upload.mp4
echo "-----"
echo "mp3 file compiled"

# upload audio file to amazon
cd /home/wadeallen/Music/Sermon_Audio
upload ${date}.mp3
echo "-----"
echo "Uploaded audio file to Amazon"

# change to post directory
~/bin/insert_data
echo "-----"
echo "Updated Sermon file with metadata"

# # # move file to Dropbox upload folder
# # cd $directory
# # mv ${date}-upload.mkv ~/Dropbox/Uploads/

# # # echo "-----"
# # # echo "File will be uploaded to Vimeo"

