#!/usr/bin/env python3

import vimeo
import config
import frontmatter
import os
import glob
from datetime import date 
from dateutil.relativedelta import relativedelta, SU
from os.path import expanduser
import datetime
from dateutil import parser

client = vimeo.VimeoClient(
  token='cf325f4e2b635c27fde7af4494fbe5c5',
  key='414383b639d7ceb2dd40ad0b0a79a3507fec87b7',
  secret='Ilol4n1waOmEeEuRH0np/qVEwxXK0QeWoY7nCJWxHuk6k5xnSCeMKY5YqZ18Ru0/JqRoeqHfdPVXA0Ekakku3HOFF7Wq42o0B9Tej8y2jslvW1tXbEAP0FAvGAGCc+iz'
)

home = expanduser("~")

today = date.today() 
format = '%Y-%m-%d'
target_date = today + relativedelta(weekday=SU(+1))
sunday = target_date.strftime(format)

path = (config.sermon_path + '/{}_sermon.md'.format(sunday))

files = glob.glob(path)

for name in files:
    post = frontmatter.load(name)
    if type(post['date']) is datetime.date:
        postdate = post['date']
    else:
        postdate = parser.parse(post['date'])

    title = post['title']
    description = post['summary']

file_name = '/home/wadeallen/Downloads/sample.mp4'
uri = client.upload(file_name, data={
  'name': title,
  'description': description
})

print (f'Your video URI is: {uri}')

target = open (home + '/Dropbox/Textbits/vimeo.txt', 'w')
target.write ('vimeo: ' + uri[8:100])
target.close ()