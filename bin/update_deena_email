#!/usr/bin/env python3

from datetime import date
from dateutil.relativedelta import relativedelta, SU
from dateutil import parser
import csv

def sunday_date(week):
    date.today()
    d = date.today() + relativedelta(weekday=SU(+week))
    fd = d.strftime('%Y-%m-%d')
    fw = d.strftime('%b %d')
    return {"short_date": fd, "long_date": fw}
    
this_short = sunday_date(1)['short_date']
this_long = sunday_date(1)['long_date']
next_short = sunday_date(2)['short_date']
next_long = sunday_date(2)['long_date']

with open('/home/wadeallen/Sites/fbcmuncie_2018/_data/youth.csv') as csvfile:
	reader = csv.DictReader(csvfile)
	for row in reader:
		if row['date'] == this_short:
			thisSunday = row['date']
			if 'y' in row['fellowship_fifth']:
				this_fellowship = f"Fellowship of the Fifth. Time: {row['fifth_time']}. Description: {row['fifth_description']}. "
			else:
				this_fellowship = None
			if 'y' in row['sunday_school']:
				this_sunday_school = f"Sunday School will be led by {row['teacher']}. "
			else:
				this_sunday_school = "No Sunday School. Youth may attend the intergenational class with James Heimlech that meets on the basement level. "
			if row['service_description']:
				this_service = f"{row['service_description']} "
			else:
				this_service = None
			if 'y' in row['home']:
				this_home = f"We will meet in the home of {row['location']} at {row['home_time']}. "
			else:
			    this_home = None		
		if row['date'] == next_short:
			nextSunday = row['date']
			if 'y' in row['fellowship_fifth']:
				next_fellowship = f"Fellowship of the Fifth. Time: {row['fifth_time']}. Description: {row['fifth_description']}. "
			else:
				next_fellowship = None
			if 'y' in row['sunday_school']:
				next_sunday_school = f"Sunday School will be led by {row['teacher']}. "
			else:
				next_sunday_school = "No Sunday School. Youth may attend the intergenational class with James Heimlech that meets on the basement level. "
			if row['service_description']:
				next_service = f"{row['service_description']} "
			else:
				next_service = None
			if 'y' in row['home']:
				next_home = f"We will meet in the home of {row['location']} at {row['home_time']}. "
			else:
			    next_home = None	
csvfile.close()

this_a = f"This Sunday, {this_long}: {this_fellowship or ''}{this_sunday_school or ''}{this_service or ''}{this_home or ''}\n\n"
next_a = f"Next Sunday, {next_long}: {next_fellowship or ''}{next_sunday_school or ''}{next_service or ''}{next_home or ''}\n\n"

target = open ('/home/wadeallen/Editing/deena.txt', 'w')
target.write('Youth Ministry Update\n\n')
target.write('Hello everyone. I just wanted to send you a quick email to remind you what is going on with the youth the next two weeks.\n\n')
target.write(this_a)
target.write(next_a)
target.write('Let me know if you have any questions.\n\nDeena')
target.close()

